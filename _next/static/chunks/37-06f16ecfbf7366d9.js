"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37],{7037:function(e,n,r){r.d(n,{dU:function(){return k},pT:function(){return y}});var t=r(7568),s=r(2670),a=r(4051),o=r.n(a),i=r(5893),c=r(536),u=r.n(c),l=r(7294),d=r(3046),f=r(726),v=r(1345),h=r(1756),x=r(8417),m=r(7424),p=r(1802),g=r(3561),w=r(1163),b=r(3282),j=(0,l.createContext)(!1),k=function(){return(0,l.useContext)(j)};function y(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.onBeforeLoad,c=void 0===a?function(){}:a;return function(){var r=(0,d.V)(["secure-page"]),a=(0,f.K)(null),l=(0,f.K)(!1),k=(0,w.useRouter)(),y=(0,f.K)(""),N=(0,v.c)(),Z=(0,b.s)(!0),T=(0,h.Mq)((function(e){C(e)}));r.useProperty(null===a.value||!T.value,"not-loaded");var C=function(){var e=(0,t.Z)(o().mark((function e(r){var t,i,u,d,f,v,h,x;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r){e.next=4;break}N.push("/login"),e.next=33;break;case 4:if(r.user.firstName||r.user.lastName){e.next=8;break}t="/account/first-login/profile",k.asPath.startsWith(t)?a.value={}:N.push(t),e.next=33;break;case 8:if(0!==r.user.addresses.length||r.user.addressSetupSkipped){e.next=12;break}i="/account/first-login/address",k.asPath.startsWith(i)?a.value={}:N.push(i),e.next=33;break;case 12:if(u=function(e){var n=m.a.getQueryParams(),r=c(e,T,n);r?(r.message&&Z.loadMessage(r.message),N.push(r.path)):a.value=e},d=n,f=m.a.getQueryParams(),e.prev=15,!d&&g.nU>-1&&(new Date).getTime()-g.ux.lastRefreshTimestamp>=60*g.nU*1e3&&(d="/users/account?action=refresh"),!d){e.next=27;break}return e.next=20,(0,g.j0)(r,d,f);case 20:v=e.sent,h=v.result,(x=v.newAccountValue)&&(T.value=x),u(h),e.next=28;break;case 27:u({});case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(15),(0,s.Z)(e.t0,g.jm)?(T.value=null,N.push("/login")):(0,s.Z)(e.t0,g.oc)?l.value=!0:(0,s.Z)(e.t0,g.Iq)&&(y.value=e.t0.message);case 33:case"end":return e.stop()}}),e,null,[[15,30]])})));return function(n){return e.apply(this,arguments)}}();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"jsx-169def0d3e7960d3 "+(r.getClassNames()||""),children:a.value&&T.value?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(j.Provider,{value:!0,children:(0,i.jsx)(e,{result:a.value,account:T})})}):(0,i.jsx)(i.Fragment,{children:""!==y.value?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"jsx-169def0d3e7960d3 error",children:["error: ",y.value]})}):l.value?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"jsx-169def0d3e7960d3 error",children:["Network error: make sure you are connected to the internet.",(0,i.jsx)("div",{className:"jsx-169def0d3e7960d3 button",children:(0,i.jsx)(p.C,{caption:"Retry",onClick:function(){l.value=!1,C(T.value)}})})]})}):(0,i.jsx)(x.Z,{})})}),(0,i.jsx)(u(),{id:"169def0d3e7960d3",children:".secure-page.jsx-169def0d3e7960d3{color:#333;padding:50rem 40rem;padding-top:20rem;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.not-loaded.jsx-169def0d3e7960d3{}.error.jsx-169def0d3e7960d3{color:#d20505;text-align:center}.button.jsx-169def0d3e7960d3{margin-top:20rem}"})]})}}},3282:function(e,n,r){r.d(n,{s:function(){return h}});var t,s=r(1799),a=r(5893),o=r(536),i=r.n(o),c=r(7294),u=r(7834),l=r(3046),d=r(2539),f=r(726);function v(e){var n=e.color,r=e.message,t=e.show,s=(0,l.V)(["status-message"]),o=(0,c.useRef)(t);o.current=t;var v=(0,c.useContext)(u.P).scalePixelToRem,h=(0,f.K)(0),x=(0,d.y)((function(){o.current&&m()})),m=function(){if(x.current){var e=x.current;h.value=v(e.offsetHeight)}};(0,c.useEffect)((function(){t?m():h.value=0}),[t]);var p={height:"".concat(h.value,"rem"),color:n};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:p,className:"jsx-29919aa63cccfd21 "+(s.getClassNames()||""),children:(0,a.jsx)("div",{ref:x,className:"jsx-29919aa63cccfd21 inner",children:r})}),(0,a.jsx)(i(),{id:"29919aa63cccfd21",children:".status-message.jsx-29919aa63cccfd21{overflow:hidden;-webkit-transition:height.4s;-moz-transition:height.4s;-o-transition:height.4s;transition:height.4s;font-weight:600}.inner.jsx-29919aa63cccfd21{width:100%;text-align:center;padding-bottom:25rem}"})]})}var h=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=(0,f.K)(""),r=(0,f.K)("This is the test message"),o=(0,f.K)(!1),i=(0,c.useRef)(0),u={error:"#dc0303",info:"#7c79e4"},l=(0,a.jsx)(v,{message:r.value,show:o.value,color:n.value});(0,c.useEffect)((function(){if(t&&!e){var n=t;t=null,d.showFromObject(n)}}),[]);var d={component:l,loadMessage:function(e){t=e},show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.closeAfterMs,a=void 0===s?-1:s,c=t.colorValue,l=void 0===c?u.info:c;clearTimeout(i.current),i.current=0,n.value=l,r.value=e,o.value=!0,a>0&&(i.current=setTimeout((function(){d.close()}),a))},showFromObject:function(e){var n=e.type,r=e.message,t=e.permanent;"info"===n?d.showInfo(r,!!t):d.showError(r,void 0===t||t)},showError:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d.show(e,(0,s.Z)({colorValue:u.error},n?{}:{closeAfterMs:7e3}))},showInfo:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.show(e,(0,s.Z)({colorValue:u.info},n?{}:{closeAfterMs:7e3}))},close:function(){o.value=!1}};return d}},3561:function(e,n,r){r.d(n,{Iq:function(){return h},j0:function(){return x},jm:function(){return f},nU:function(){return l},oc:function(){return v},ux:function(){return d}});var t=r(7568),s=r(1438),a=r(1799),o=r(4051),i=r.n(o),c=r(7719),u=r(7424),l=30,d={lastRefreshTimestamp:0},f=function e(){(0,s.Z)(this,e)},v=function e(){(0,s.Z)(this,e)},h=function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,s.Z)(this,e),this.message=n,this.inputNames=r},x=function(){var e=(0,t.Z)(i().mark((function e(n,r,s){var o,l,x,m,p,g,w,b;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=c.J5.hi,l="".concat(o).concat(r);case 3:return e.next=6,(0,t.Z)(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=5,t=0;case 2:return e.prev=3,e.next=6,fetch(l,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify((0,a.Z)({},s,n?{session:(0,a.Z)({userId:n.user.accountNumber,sessionId:n.session.id},x?{renewHash:x}:{})}:{}))});case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(t<r)){e.next=17;break}return t++,e.next=15,u.a.sleep(500);case 15:e.next=18;break;case 17:throw new v;case 18:e.next=2;break;case 20:case"end":return e.stop()}}),e,null,[[3,9]])})))();case 6:return m=e.sent,e.next=9,m.json();case 9:if("error"!==(null===(p=e.sent)||void 0===p?void 0:p.type)){e.next=24;break}if(!n||"session-expired"!==p.errorMessage){e.next=17;break}return e.next=14,u.a.sha1Hash("".concat(n.session.id,"-").concat(n.user.accountNumber,"-").concat(n.session.renewKey));case 14:x=e.sent,e.next=22;break;case 17:if("permission-denied"!==(null===p||void 0===p?void 0:p.errorMessage)){e.next=21;break}throw new f;case 21:throw new h((null===p||void 0===p?void 0:p.errorMessage)||"Unexpected response from server",Array.isArray(null===p||void 0===p?void 0:p.errorInputNames)?null===p||void 0===p?void 0:p.errorInputNames:[]);case 22:e.next=32;break;case 24:if("success"!==(null===p||void 0===p?void 0:p.type)){e.next=31;break}return delete p.type,g=void 0,n&&(w=p.refreshUser,x&&p.renewedSession?(b=p.renewedSession,g={user:w,session:b},delete p.renewedSession):g={user:w,session:n.session},d.lastRefreshTimestamp=(new Date).getTime(),delete p.refreshUser),e.abrupt("return",(0,a.Z)({result:p},g?{newAccountValue:g}:{}));case 31:throw new h("Unexpected response from server");case 32:e.next=3;break;case 34:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}()},2670:function(e,n,r){function t(e,n){return null!=n&&"undefined"!==typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n}r.d(n,{Z:function(){return t}})}}]);
//# sourceMappingURL=37-06f16ecfbf7366d9.js.map